name: CI

on:
  release:
    types: [published]
  workflow_dispatch:

jobs:
  pull-latest-release:
    runs-on: self-hosted
    
    env:
      REPO_PATH: /home/kali/repos/test-self-hosted-runners
      RELEASE_BRANCH_NAME: ${{ github.event.release.tag_name }}

    steps:
      - name: Update branch
        run: |
          cd "$REPO_PATH"
          git fetch
          git checkout "refs/heads/$RELEASE_BRANCH_NAME"
          git pull origin "$RELEASE_BRANCH_NAME"

      - name: Verify current branch
        run: |
          echo "Workflow triggered checkout to branch: $RELEASE_BRANCH_NAME"
          CURRENT_BRANCH=$(git branch | grep '*' | head -n 1)
          echo "Current branch: $CURRENT_BRANCH"
          
